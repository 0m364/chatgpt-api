<div class="outer-container">
  <div>
    <div class="header">
      <button (click)="close()" class="btn btn-close"></button>
    </div>
    <div class="content">
      <h1 class="text-center">Your saved chats:</h1>
      <h5 class="text-center" *ngIf="messageHistory.length === 0">You have no saved chats!</h5>
      <div class="accordion-container" [style.max-height]="containerHeight">
        <mat-accordion class="headers-align">
          <mat-expansion-panel
            *ngFor="let chat of messageHistory"
            [expanded]="steps === messageHistory.indexOf(chat) + 1"
            hideToggle
          >
            <mat-expansion-panel-header class="application-list-header">
              <mat-panel-title> {{ chat.name }} </mat-panel-title>
              <mat-panel-description>
                Created on {{ chat.createdOnDate }}
              </mat-panel-description>
            </mat-expansion-panel-header>
            <div>
              <div class="chatbox">
                <div *ngFor="let message of chat.messages">
                  <div *ngIf="message.isUser" class="user-message">
                    {{ message.contentRaw }}
                  </div>
                  <div *ngIf="!message.isUser" class="gpt-message">
                    {{ message.contentRaw }}
                  </div>
                </div>
              </div>
              <mat-divider></mat-divider>
              <div class="loadChatBtns">
                <button *ngIf="!chatSelected" class="loadChatButton button btn-primary"
                        (click)="loadChat(chat, false)">
                  Load this chat
                </button>
                <button *ngIf="!aboutToDelete && !chatSelected" (click)="aboutToDelete = !aboutToDelete"
                        class="button-danger deleteButton">
                  <i class="bi-trash3"></i>
                </button>
                <button *ngIf="aboutToDelete" (click)="deleteChat(chat)" class="button-danger deleteConfirmButton">
                  <i class="bi-check-lg"></i>
                </button>
                <button *ngIf="aboutToDelete" (click)="aboutToDelete = !aboutToDelete"
                        class="button deleteConfirmButton">
                  <i class="bi-x-lg"></i>
                </button>
              </div>
              <div class="confirmLoadChat" *ngIf="chatSelected">
                <h5 class="text-center">You have an active chat right now! Loading this chat will wipe your current
                  one.</h5>
                <h6 class="text-center">Are you sure you want to load this chat?</h6>
                <div class="confirmLoadButtons">
                  <button (click)="loadChat(chat, true)" class="button-danger">Yes, load this chat.</button>
                  <button (click)="cancelLoadChat()" class="button">No! Go back!</button>
                </div>

              </div>
            </div>

          </mat-expansion-panel>
        </mat-accordion>
      </div>

    </div>
    <div class="footer" *ngIf="!chatSelected">
      <input [(ngModel)]="chatName" class="mat-input-element chatNameInput" placeholder="Enter a name for your chat">
      <button *ngIf="chatName != currentLoadedChatName || chatName.length == 0" class="btn btn-primary saveChatBtn"
              [disabled]="chatName.length === 0"
              [matTooltip]="'You can\'t save a chat without a name!'" [matTooltipDisabled]="chatName.length > 0"
              (click)="saveChat()">Save this chat
      </button>
      <button *ngIf="chatName == currentLoadedChatName && currentLoadedChatName.length > 0"
              class="btn btn-primary saveChatBtn" [disabled]="chatName.length === 0"
              [matTooltip]="'You can\'t save a chat without a name!'" [matTooltipDisabled]="chatName.length > 0"
              (click)="saveChat()">Update this chat
      </button>
    </div>

  </div>
</div>

